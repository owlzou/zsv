[{"C:\\OWL\\Code\\zshaderviewer\\src\\utils\\data.js":"1","C:\\OWL\\Code\\zshaderviewer\\src\\utils\\webgl.js":"2","C:\\OWL\\Code\\zshaderviewer\\src\\PresetModal.js":"3","C:\\OWL\\Code\\zshaderviewer\\src\\VaribleModal.js":"4","C:\\OWL\\Code\\zshaderviewer\\src\\index.tsx":"5","C:\\OWL\\Code\\zshaderviewer\\src\\App.tsx":"6","C:\\OWL\\Code\\zshaderviewer\\src\\Components\\ZCanvas.tsx":"7","C:\\OWL\\Code\\zshaderviewer\\src\\Components\\Cmirror.tsx":"8"},{"size":1642,"mtime":1609419157093,"results":"9","hashOfConfig":"10"},{"size":4549,"mtime":1609411222230,"results":"11","hashOfConfig":"10"},{"size":1385,"mtime":1609410606187,"results":"12","hashOfConfig":"10"},{"size":1158,"mtime":1609407410378,"results":"13","hashOfConfig":"10"},{"size":346,"mtime":1620308629646,"results":"14","hashOfConfig":"10"},{"size":3222,"mtime":1620368083277,"results":"15","hashOfConfig":"10"},{"size":4746,"mtime":1620364379588,"results":"16","hashOfConfig":"10"},{"size":698,"mtime":1620310491688,"results":"17","hashOfConfig":"10"},{"filePath":"18","messages":"19","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},"bd6pb4",{"filePath":"21","messages":"22","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},{"filePath":"23","messages":"24","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},{"filePath":"25","messages":"26","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},{"filePath":"27","messages":"28","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"29"},{"filePath":"30","messages":"31","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"32","messages":"33","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"34","usedDeprecatedRules":"29"},{"filePath":"35","messages":"36","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"29"},"C:\\OWL\\Code\\zshaderviewer\\src\\utils\\data.js",[],["37","38"],"C:\\OWL\\Code\\zshaderviewer\\src\\utils\\webgl.js",[],"C:\\OWL\\Code\\zshaderviewer\\src\\PresetModal.js",[],"C:\\OWL\\Code\\zshaderviewer\\src\\VaribleModal.js",[],"C:\\OWL\\Code\\zshaderviewer\\src\\index.tsx",[],["39","40"],"C:\\OWL\\Code\\zshaderviewer\\src\\App.tsx",[],"C:\\OWL\\Code\\zshaderviewer\\src\\Components\\ZCanvas.tsx",["41"],"import React, { useRef, useEffect, useState } from \"react\";\r\nimport { draw } from \"../utils/webgl.js\";\r\nimport imgph from \"../assets/jessica-pamp-sGRMspZmfPE-unsplash.jpg\";\r\nimport { Upload, Download } from \"@geist-ui/react-icons\";\r\nimport { Button, Row, Select, Divider } from \"@geist-ui/react\";\r\n\r\ninterface IZCanvas {\r\n  vertexSource: string;\r\n  fragmentSource: string;\r\n  onError: (a: string | undefined) => void;\r\n}\r\n\r\ninterface IForm {\r\n  background: BaseCanvas;\r\n}\r\n\r\nenum BaseCanvas {\r\n  Image,\r\n  CustomImage,\r\n}\r\n\r\nfunction str2BaseCanvas(val: string): BaseCanvas {\r\n  switch (val) {\r\n    case \"Image\":\r\n      return BaseCanvas.Image;\r\n    case \"CustomImage\":\r\n      return BaseCanvas.CustomImage;\r\n    default:\r\n      return BaseCanvas.Image;\r\n  }\r\n}\r\n\r\nfunction baseCanvas2str(val: BaseCanvas): string {\r\n  switch (val) {\r\n    case BaseCanvas.Image:\r\n      return \"Image\";\r\n    case BaseCanvas.CustomImage:\r\n      return \"CustomImage\";\r\n  }\r\n}\r\n\r\nfunction ZCanvas(props: IZCanvas) {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const [image, setImage] = useState<HTMLImageElement | null>(null);\r\n  const [form, setForm] = useState<IForm>({ background: BaseCanvas.Image });\r\n\r\n  const loadImage = (src: string | ArrayBuffer | null) => {\r\n    if (typeof src == \"object\") {\r\n      return;\r\n    }\r\n    console.log(\"Load Image\");\r\n    let img = new Image();\r\n    img.src = src || imgph;\r\n    img.onload = () => {\r\n      console.log(\"Image loaded\");\r\n      canvasRef!.current!.width = img.width;\r\n      canvasRef!.current!.height = img.height;\r\n      const gl = canvasRef!.current!.getContext(\"webgl2\")!;\r\n      gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n      setImage(img);\r\n    };\r\n  };\r\n\r\n  const load = (val: BaseCanvas) => {\r\n    switch (val) {\r\n      case BaseCanvas.Image:\r\n        loadImage(imgph);\r\n        break;\r\n      case BaseCanvas.CustomImage:\r\n        break;\r\n      default:\r\n        loadImage(val);\r\n        break;\r\n    }\r\n  };\r\n\r\n  const bgHandle = (val: String | string[]) => {\r\n    if (typeof val == \"string\") {\r\n      let bc = str2BaseCanvas(val);\r\n      let obj = { ...form, background: bc };\r\n      load(bc);\r\n      setForm(obj);\r\n    }\r\n  };\r\n\r\n  const uploadImage = () => {\r\n    const input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n    input.accept = \"image/*\";\r\n    input.onchange = () => {\r\n      if (input.files![0]) {\r\n        var reader = new FileReader();\r\n        reader.onload = (event) => {\r\n          loadImage(event.target!.result);\r\n        };\r\n        reader.readAsDataURL(input.files![0]);\r\n      }\r\n    };\r\n    input.click();\r\n  };\r\n\r\n  const downloadImage = () => {\r\n    const url = canvasRef!.current!.toDataURL(\"image/png\");\r\n    const a = document.createElement(\"a\");\r\n    a.download = \"download\";\r\n    a.href = url;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    a.remove();\r\n  };\r\n\r\n  //当shader变化的时候，重新编译＆绘图\r\n  useEffect(() => {\r\n    try {\r\n      const gl = canvasRef!.current!.getContext(\"webgl2\", {\r\n        preserveDrawingBuffer: true,\r\n      });\r\n      image && draw(gl, props.vertexSource, props.fragmentSource, image);\r\n      props.onError(\"\");\r\n    } catch (e) {\r\n      console.log(e.message);\r\n      props.onError(e.message);\r\n    }\r\n  }, [props.vertexSource, props.fragmentSource, image, props]);\r\n\r\n  //初始化，加载图片\r\n  useEffect(() => {\r\n    load(BaseCanvas.Image);\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <div style={{ textAlign: \"center\" }}>\r\n        <canvas\r\n          ref={canvasRef}\r\n          style={{ height: \"50vh\", width: \"100%\", objectFit: \"contain\" }}\r\n        ></canvas>\r\n      </div>\r\n      <Divider />\r\n      <form className=\"control\">\r\n        <Row>\r\n          <label>背景</label>\r\n          <Select\r\n            placeholder=\"选择背景\"\r\n            onChange={bgHandle}\r\n            value={baseCanvas2str(form.background)}\r\n          >\r\n            <Select.Option value=\"Image\">图片一</Select.Option>\r\n            <Select.Option value=\"CustomImage\">自定义图片</Select.Option>\r\n          </Select>\r\n          {form.background === BaseCanvas.CustomImage && (\r\n            <>\r\n              <Button\r\n                size=\"small\"\r\n                icon={<Upload />}\r\n                type=\"secondary\"\r\n                onClick={uploadImage}\r\n                auto\r\n              >\r\n                上传图片\r\n              </Button>\r\n              <Button\r\n                size=\"small\"\r\n                icon={<Download />}\r\n                onClick={downloadImage}\r\n                auto\r\n              >\r\n                下载图片\r\n              </Button>\r\n            </>\r\n          )}\r\n        </Row>\r\n      </form>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ZCanvas;\r\n","C:\\OWL\\Code\\zshaderviewer\\src\\Components\\Cmirror.tsx",[],{"ruleId":"42","replacedBy":"43"},{"ruleId":"44","replacedBy":"45"},{"ruleId":"42","replacedBy":"43"},{"ruleId":"44","replacedBy":"45"},{"ruleId":"46","severity":1,"message":"47","line":129,"column":6,"nodeType":"48","endLine":129,"endColumn":8,"suggestions":"49"},"no-native-reassign",["50"],"no-negated-in-lhs",["51"],"react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","ArrayExpression",["52"],"no-global-assign","no-unsafe-negation",{"desc":"53","fix":"54"},"Update the dependencies array to be: [load]",{"range":"55","text":"56"},[3385,3387],"[load]"]