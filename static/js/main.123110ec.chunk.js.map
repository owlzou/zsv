{"version":3,"sources":["utils/data.js","utils/webgl.js","assets/jessica-pamp-sGRMspZmfPE-unsplash.jpg","Components/ZCanvas.tsx","Components/PresetModal.tsx","Components/Cmirror.tsx","Components/VaribleModal.tsx","App.tsx","assets/favicon-32x32.png","index.tsx"],"names":["preset","vex","frag","name","note","attribute","type","description","createShader","gl","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","Error","getShaderInfoLog","simpleBindBuffer","shaderProgram","data","size","offset","stride","indices","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","index","getAttribLocation","vertexAttribPointer","FLOAT","indexesBuffer","ELEMENT_ARRAY_BUFFER","Uint16Array","enableVertexAttribArray","draw","vertexSource","fragmentSource","image","clearColor","clear","COLOR_BUFFER_BIT","vsource","fsource","vertShader","VERTEX_SHADER","fragShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","getProgram","useProgram","uniform2f","getUniformLocation","parseFloat","width","toFixed","height","texture","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_NEAREST","generateMipmap","uniform1i","drawArrays","TRIANGLE_STRIP","BaseCanvas","baseCanvas2str","val","Image","CustomImage","ZCanvas","props","canvasRef","useRef","useState","setImage","background","form","setForm","loadImage","useCallback","src","console","log","img","imgph","onload","current","getContext","viewport","canvas","useEffect","preserveDrawingBuffer","onError","e","message","style","textAlign","ref","objectFit","className","gap","flexWrap","placeholder","onChange","bc","str2BaseCanvas","obj","value","Option","icon","onClick","input","document","createElement","accept","onchange","files","reader","FileReader","event","target","result","readAsDataURL","click","auto","url","toDataURL","a","download","href","body","appendChild","remove","PresetModal","visible","setVisible","closeHandler","open","onClose","Title","Content","Container","map","item","onPreset","Action","passive","close","Cmirror","onBeforeChange","editor","options","tabSize","mode","theme","matchBrackets","lineNumbers","VaribleModal","Column","prop","label","App","setVertexSource","setFragmentSource","undefined","error","setError","alignContent","padding","sm","md","marginRight","transform","alt","h4","margin","display","window","minHeight","readOnly","initialValue","Item","code","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.123110ec.chunk.js","sourcesContent":["import { Code } from \"@geist-ui/react\";\nexport const preset = [\n  {\n    vex:\n      \"attribute vec3 aPosition;\\nattribute vec2 aTexCoord;\\nvarying lowp vec2 vTexCoord;\\nvoid main(){\\n    vTexCoord = aTexCoord;\\n    gl_Position=vec4(aPosition,1.0);\\n}\",\n    frag:\n      \"varying lowp vec2 vTexCoord;\\nuniform sampler2D uSampler;\\nvoid main(){\\n    // vTexCoord是当前处理的点在图片里的坐标 \\n    // texture2D 是提取纹理中对应坐标的颜色\\n    gl_FragColor = texture2D(uSampler,vTexCoord);\\n}\",\n    name: \"图片-基础\",\n  },\n  {\n    vex:\n      \"attribute vec3 aPosition;\\nattribute vec2 aTexCoord;\\nvarying lowp vec2 vTexCoord;\\nvoid main(){\\n    vTexCoord = aTexCoord;\\n    gl_Position=vec4(aPosition,1.0);\\n}\",\n    frag:\n      \"varying lowp vec2 vTexCoord;\\nuniform sampler2D uSampler;\\nvoid main(){\\n    lowp vec4 color = texture2D(uSampler,vTexCoord);\\n    lowp float gray = color[0]*0.3 + color[1]*0.59 + color[2]*0.11;\\n    lowp vec4 new_color = vec4(gray,gray,gray,1);\\n    gl_FragColor = new_color;\\n}\",\n    name: \"图片-灰度\",\n  },\n];\n\nexport const note = [\n  {\n    attribute: \"attribute\",\n    type: \"vec3\",\n    name: <Code>aPosition</Code>,\n    description: \"输入坐标\",\n  },\n  {\n    attribute: \"attribute\",\n    type: \"vec2\",\n    name: <Code>aTexCoord</Code>,\n    description: \"顶点的纹理坐标\",\n  },\n  {\n    attribute: \"uniform\",\n    type: \"sampler2D\",\n    name: <Code>uSampler</Code>,\n    description: \"纹理数据\",\n  },\n  {\n    attribute: \"uniform\",\n    type: \"vec2\",\n    name: <Code>uTextureSize</Code>,\n    description: \"图片的大小\",\n  },\n];\n","/**\n * 编译着色器\n *\n * @param {WebGLRenderingContext} gl - gl上下文\n * @param {string} source - 着色器源码\n * @param {*} type - 类型，gl.VERTEX_SHADER 或 gl.FRAGMENT_SHADER\n * @returns\n */\nfunction createShader(gl, source, type) {\n  let shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    //console.log(type, \"complie failed.\");\n    throw new Error(`ShaderInfoLog:\\n${gl.getShaderInfoLog(shader)}`);\n  }\n  //console.log(`ShaderInfoLog: ${gl.getShaderInfoLog(shader)}`);\n  return shader;\n}\n\n/**\n * 编译并连接着色器\n *\n * @export\n * @param {WebGLRenderingContext} gl - gl上下文\n * @param {string} vsource - 顶点着色器源码\n * @param {string} fsource - 片段着色器源码\n * @returns {WebGLProgram|null} - 连接好的WebGLProgram，失败则返回null\n */\nexport function getProgram(gl, vsource, fsource) {\n  let vertShader = createShader(gl, vsource, gl.VERTEX_SHADER);\n  let fragShader = createShader(gl, fsource, gl.FRAGMENT_SHADER);\n  let shaderProgram = gl.createProgram();\n  gl.attachShader(shaderProgram, vertShader);\n  gl.attachShader(shaderProgram, fragShader);\n  gl.linkProgram(shaderProgram);\n  if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n    //console.log(\"link program error:\", gl.getProgramInfoLog(shaderProgram));\n    throw new Error(`ProgramInfoLog:\\n${gl.getProgramInfoLog(shaderProgram)}`);\n  }\n  //console.log(`ProgramInfoLog: ${gl.getProgramInfoLog(shaderProgram)}`);\n  return shaderProgram;\n}\n\n/**\n * 简单缓冲绑定\n *\n * @param {*} gl - gl上下文\n * @param {*} shaderProgram - shaderProgram\n * @param {*} name - 着色器里的属性名称\n * @param {*} data - 数据源\n * @param {*} size - 一组数据长度\n * @param {*} offset - 偏移\n * @param {*} stride - 步长\n * @param {*} indices - 索引（如果有）\n * @returns buffer\n */\nexport function simpleBindBuffer(\n  gl,\n  shaderProgram,\n  name,\n  data,\n  size,\n  offset,\n  stride,\n  indices = null\n) {\n  const buffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n  const index = gl.getAttribLocation(shaderProgram, name);\n  gl.vertexAttribPointer(index, size, gl.FLOAT, false, offset, stride);\n\n  if (indices != null) {\n    const indexesBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexesBuffer);\n    gl.bufferData(\n      gl.ELEMENT_ARRAY_BUFFER,\n      new Uint16Array(indices),\n      gl.STATIC_DRAW\n    );\n  }\n\n  gl.enableVertexAttribArray(index);\n  return buffer;\n}\n\n/**\n *\n *\n * @param {*} gl - gl上下文\n * @param {*} shaderProgram - shaderProgram\n * @param {*} image - 图片元素\n * @returns\n */\nexport function bindTexture(gl, shaderProgram, image) {\n  let texture = gl.createTexture();\n  //绑定纹理\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  //指定二维纹理贴图，详细级别。颜色组件，数据格式，数据类型，数据源\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n  //设置纹理在放大和缩小时候采用的采样方案。\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  gl.texParameteri(\n    gl.TEXTURE_2D,\n    gl.TEXTURE_MIN_FILTER,\n    gl.LINEAR_MIPMAP_NEAREST\n  );\n  //生成mipmap webgl 1.0 只能给图片边长为2的幂的图片生成 mipmap\n  gl.generateMipmap(gl.TEXTURE_2D);\n  //结束设置\n  //gl.activeTexture(gl.TEXTURE0);\n  gl.uniform1i(gl.getUniformLocation(shaderProgram, \"uSampler\"), 0);\n}\n\nexport function draw(gl, vertexSource, fragmentSource, image) {\n  //正方形\n  const vertices = [-1, -1, 0, -1, 1, 0, 1, -1, 0, 1, 1, 0];\n  //纹理对应坐标\n  const tex = [0, 1, 0, 0, 1, 1, 1, 0];\n  gl.clearColor(0, 0, 0, 1);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n  //创建着色器\n  const shaderProgram = getProgram(gl, vertexSource, fragmentSource);\n  //设置缓冲\n  simpleBindBuffer(gl, shaderProgram, \"aPosition\", vertices, 3, 0, 0);\n  simpleBindBuffer(gl, shaderProgram, \"aTexCoord\", tex, 2, 0, 0);\n  gl.useProgram(shaderProgram);\n  //未来添加其他可以绑定的参数也在这里：\n  // canvas 的大小\n  gl.uniform2f(\n    gl.getUniformLocation(shaderProgram, \"uTextureSize\"),\n    parseFloat(image.width).toFixed(1),\n    parseFloat(image.height).toFixed(1)\n  );\n  //\n  bindTexture(gl, shaderProgram, image);\n  //加载完纹理后再画图\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n}\n","export default __webpack_public_path__ + \"static/media/jessica-pamp-sGRMspZmfPE-unsplash.5cffdaca.jpg\";","import React, { useCallback, useRef, useEffect, useState } from \"react\";\nimport { draw } from \"../utils/webgl.js\";\nimport imgph from \"../assets/jessica-pamp-sGRMspZmfPE-unsplash.jpg\";\nimport { Upload, Download } from \"@geist-ui/react-icons\";\nimport { Button, Row, Select, Divider, Text } from \"@geist-ui/react\";\n\ninterface IZCanvas {\n  vertexSource: string;\n  fragmentSource: string;\n  onError: (a: string | undefined) => void;\n}\n\ninterface IForm {\n  background: BaseCanvas;\n}\n\nenum BaseCanvas {\n  Image,\n  CustomImage,\n}\n\nfunction str2BaseCanvas(val: string): BaseCanvas {\n  switch (val) {\n    case \"Image\":\n      return BaseCanvas.Image;\n    case \"CustomImage\":\n      return BaseCanvas.CustomImage;\n    default:\n      return BaseCanvas.Image;\n  }\n}\n\nfunction baseCanvas2str(val: BaseCanvas): string {\n  switch (val) {\n    case BaseCanvas.Image:\n      return \"Image\";\n    case BaseCanvas.CustomImage:\n      return \"CustomImage\";\n  }\n}\n\nfunction ZCanvas(props: IZCanvas) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [image, setImage] = useState<HTMLImageElement | null>(null);\n  const [form, setForm] = useState<IForm>({ background: BaseCanvas.Image });\n\n  const loadImage = useCallback(\n    (src: string | ArrayBuffer | null) => {\n      if (typeof src == \"object\") {\n        return;\n      }\n      console.log(\"Load Image\");\n      let img = new Image();\n      img.src = src || imgph;\n      img.onload = () => {\n        console.log(\"Image loaded\");\n        canvasRef!.current!.width = img!.width;\n        canvasRef!.current!.height = img!.height;\n        const gl = canvasRef!.current!.getContext(\"webgl2\")!;\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n        setImage(img);\n      };\n    },\n    [canvasRef]\n  );\n\n  const bgHandle = (val: String | string[]) => {\n    if (typeof val == \"string\") {\n      let bc: BaseCanvas = str2BaseCanvas(val);\n      let obj = { ...form, background: bc };\n      setForm(obj);\n    }\n  };\n\n  const uploadImage = () => {\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.accept = \"image/*\";\n    input.onchange = () => {\n      if (input.files![0]) {\n        var reader = new FileReader();\n        reader.onload = (event) => {\n          loadImage(event.target!.result);\n        };\n        reader.readAsDataURL(input.files![0]);\n      }\n    };\n    input.click();\n  };\n\n  const downloadImage = () => {\n    const url = canvasRef!.current!.toDataURL(\"image/png\");\n    const a = document.createElement(\"a\");\n    a.download = \"download\";\n    a.href = url;\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n  };\n\n  //当shader变化的时候，重新编译＆绘图\n  useEffect(() => {\n    try {\n      const gl = canvasRef!.current!.getContext(\"webgl2\", {\n        preserveDrawingBuffer: true,\n      });\n      image && draw(gl, props.vertexSource, props.fragmentSource, image);\n      props.onError(\"\");\n    } catch (e) {\n      //console.log(e.message);\n      props.onError(e.message);\n    }\n  }, [image, props]);\n\n  //初始化\n  useEffect(() => {\n    loadImage(imgph);\n  }, [loadImage]);\n\n  return (\n    <>\n      <div style={{ textAlign: \"center\" }}>\n        <canvas\n          ref={canvasRef}\n          style={{ height: \"50vh\", width: \"100%\", objectFit: \"contain\" }}\n        ></canvas>\n      </div>\n      <Divider />\n      <form className=\"control\">\n        <Row gap={0.8} style={{ flexWrap: \"wrap\" }}>\n          <Text>背景</Text>\n\n          <Select\n            placeholder=\"选择背景\"\n            onChange={bgHandle}\n            value={baseCanvas2str(form.background)}\n          >\n            <Select.Option value=\"Image\">图片一</Select.Option>\n            <Select.Option value=\"CustomImage\">自定义图片</Select.Option>\n          </Select>\n\n          {form.background === BaseCanvas.CustomImage && (\n            <>\n              <Button\n                size=\"small\"\n                icon={<Upload />}\n                type=\"secondary\"\n                onClick={uploadImage}\n                auto\n              >\n                上传图片\n              </Button>\n              <Button\n                size=\"small\"\n                icon={<Download />}\n                onClick={downloadImage}\n                auto\n              >\n                下载图片\n              </Button>\n            </>\n          )}\n        </Row>\n      </form>\n    </>\n  );\n}\n\nexport default ZCanvas;\n","import React, { useState } from \"react\";\nimport { Folder } from \"@geist-ui/react-icons\";\nimport { Button, Modal, Grid } from \"@geist-ui/react\";\nimport { preset } from \"../utils/data.js\";\n\nexport interface Preset {\n  name: string;\n  vex: string;\n  frag: string;\n}\n\ninterface IPresetModal {\n  onPreset: (a: Preset) => void;\n}\n\nfunction PresetModal(props: IPresetModal) {\n  const [visible, setVisible] = useState(false);\n  const closeHandler = () => {\n    setVisible(false);\n  };\n  return (\n    <>\n      <Button\n        icon={<Folder />}\n        auto\n        type=\"abort\"\n        onClick={() => setVisible(true)}\n      >\n        加载预设\n      </Button>\n      <Modal open={visible} onClose={closeHandler} width=\"30rem\">\n        <Modal.Title>选择预设</Modal.Title>\n        <Modal.Content>\n          <Grid.Container gap={2}>\n            {preset.map((item, index) => {\n              return (\n                <Grid key={index}>\n                  <Button\n                    onClick={() => {\n                      props.onPreset(item);\n                      closeHandler();\n                    }}\n                    key={index}\n                  >\n                    {item.name}\n                  </Button>\n                </Grid>\n              );\n            })}\n          </Grid.Container>\n        </Modal.Content>\n        <Modal.Action passive onClick={({ close }) => close()}>\n          关闭\n        </Modal.Action>\n      </Modal>\n    </>\n  );\n}\n\nexport default PresetModal;\n","import React from \"react\";\nimport { Controlled as CodeMirror } from \"react-codemirror2\";\nimport \"codemirror/lib/codemirror.css\";\nimport \"codemirror/mode/clike/clike.js\";\nimport \"codemirror/theme/dracula.css\";\n\ninterface ICmirror {\n  value: string;\n  onChange: (a: string) => void;\n}\n\nexport default function Cmirror(props: ICmirror) {\n  const options = {\n    tabSize: 4,\n    mode: \"x-shader/x-vertex\",\n    theme: \"dracula\",\n    matchBrackets: true,\n    lineNumbers: true,\n  };\n  return (\n    <CodeMirror\n      value={props.value}\n      onBeforeChange={(editor, data, value) => {\n        props.onChange(value);\n      }}\n      options={options}\n    ></CodeMirror>\n  );\n}\n","//显示支持的变量\nimport React, { useState } from \"react\";\nimport { Button, Modal, Table } from \"@geist-ui/react\";\nimport { Lambda } from \"@geist-ui/react-icons\";\nimport { note } from \"../utils/data.js\";\n\nfunction VaribleModal() {\n  const [visible, setVisible] = useState(false);\n  const closeHandler = () => {\n    setVisible(false);\n  };\n  const data = note;\n\n  return (\n    <>\n      <Button\n        icon={<Lambda />}\n        auto\n        type=\"abort\"\n        onClick={() => setVisible(true)}\n      >\n        变量支持\n      </Button>\n      <Modal open={visible} onClose={closeHandler} width=\"35rem\">\n        <Modal.Content>\n          <Table data={data}>\n            <Table.Column prop=\"attribute\" label=\"属性\" />\n            <Table.Column prop=\"type\" label=\"类型\" />\n            <Table.Column prop=\"name\" label=\"名称\" />\n            <Table.Column prop=\"description\" label=\"描述\" />\n          </Table>\n        </Modal.Content>\n        <Modal.Action passive onClick={({ close }) => close()}>\n          关闭\n        </Modal.Action>\n      </Modal>\n    </>\n  );\n}\n\nexport default VaribleModal;\n","import \"./App.css\";\nimport React, { useState } from \"react\";\nimport { Button, Text, Badge, Grid, Tabs, Textarea } from \"@geist-ui/react\";\nimport { Github } from \"@geist-ui/react-icons\";\nimport { preset } from \"./utils/data.js\";\nimport ZCanvas from \"./Components/ZCanvas\";\nimport PresetModal, { Preset } from \"./Components/PresetModal\";\nimport Cmirror from \"./Components/Cmirror\";\nimport VaribleModal from \"./Components/VaribleModal\";\nimport logo from \"./assets/favicon-32x32.png\";\n\ntype Error = string | undefined;\n\nfunction App() {\n  const [vertexSource, setVertexSource] = useState(preset[0].vex);\n  const [fragmentSource, setFragmentSource] = useState(preset[0].frag);\n  const [error, setError] = useState<Error>(undefined);\n\n  const onPreset = (preset: Preset) => {\n    console.log(`Load preset ${preset.name}`);\n    setVertexSource(preset.vex);\n    setFragmentSource(preset.frag);\n  };\n\n  return (\n    <div className=\"App\">\n      <Grid.Container\n        gap={2}\n        alignContent=\"center\"\n        style={{ padding: \"0 32px\", height: \"70px\" }}\n      >\n        <Grid sm={24} md={12}>\n          <img\n            src={logo}\n            style={{ marginRight: \"10px\", transform: \"translateY(25%)\" }}\n            alt=\"logo\"\n          ></img>\n          <Text\n            h4\n            style={{\n              margin: \"0\",\n              display: \"inline-block\",\n              marginRight: \"10px\",\n            }}\n          >\n            Z ShaderViewer\n          </Text>\n          <Badge size=\"small\">Beta</Badge>\n        </Grid>\n        <Grid sm={24} md={12}>\n          <div className=\"nav-right\">\n            <VaribleModal />\n            <PresetModal onPreset={onPreset} />\n            <Button\n              icon={<Github />}\n              auto\n              type=\"abort\"\n              onClick={() => {\n                window.open(\"https://github.com/owlzou/zsv\", \"_blank\");\n              }}\n            >\n              Github\n            </Button>\n          </div>\n        </Grid>\n      </Grid.Container>\n      <Grid.Container gap={2} style={{ padding: \"0 20px\" }}>\n        <Grid sm={24} md={12}>\n          <ZCanvas\n            vertexSource={vertexSource}\n            fragmentSource={fragmentSource}\n            onError={(e: Error) => setError(e)}\n          ></ZCanvas>\n\n          <div className=\"control\">\n            <Textarea\n              value={error ? error : \"\"}\n              width=\"100%\"\n              minHeight=\"200px\"\n              readOnly\n            ></Textarea>\n          </div>\n        </Grid>\n        <Grid sm={24} md={12}>\n          <Tabs initialValue=\"1\">\n            <Tabs.Item label=\"顶点着色器\" value=\"1\">\n              <Cmirror\n                value={vertexSource}\n                onChange={(code: string) => {\n                  setVertexSource(code);\n                }}\n              ></Cmirror>\n            </Tabs.Item>\n            <Tabs.Item label=\"片段着色器\" value=\"2\">\n              <Cmirror\n                value={fragmentSource}\n                onChange={(code: string) => setFragmentSource(code)}\n              ></Cmirror>\n            </Tabs.Item>\n          </Tabs>\n        </Grid>\n      </Grid.Container>\n    </div>\n  );\n}\n\nexport default App;\n","export default \"data:image/png;base64,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\"","import React from \"react\";\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport { GeistProvider, CssBaseline } from \"@geist-ui/react\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <GeistProvider>\n      <CssBaseline />\n      <App />\n    </GeistProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}